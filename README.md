# The Avenue Concept Image Resizer

This is a lightweight Google App Engine service developed for the avenue concept to deal with image resizing. It's designed to respond to POST requests containing the url of an image to download. The service downloads the passed image, stores the image in Google Cloud Store, and then generates a `serving_url` from the Google Cloud Store object. This serving url is a persistent url that can be called with parameters specifying the desired width, height, and crop of the given image. See the Google App Engine Images api page for `get_serving_url` [here](https://cloud.google.com/appengine/docs/standard/python/refdocs/google.appengine.api.images#google.appengine.api.images.get_serving_url) for details on the available parameters.

## Successful Requests

This application has a single route, at `/upload`. This route expects an http `POST` request to be made to it with form-data that encodes a `url=` parameter, with the value set to the public URL of a zoho image.

When it receives such a request, it will download the image in the `"url"` key, save that image to Google Cloud Storage, and generate a secure serving url for the saved image. If all these steps execute successfully, it will return a response of the following form:

```json
{
    "success": true,
    "urls": {
        "original": "{{ the passed public url from Zoho }}",
        "resize": "{{ the resize url generated by Google App Engine }}"
    },
    "key": "{{ the Google App Engine blobstore key representing the object; useful for deletion later }}",
    "location": "{{ the Google Cloud Storage bucket the source image was saved to; useful for deletion later }}"
}
```

At this point, the requesting application can save the image url for serving the image in client applications, and keep the location and the key handy so the blobstore and Google Cloud Storage data can be deleted later.


## Failing Requests

This application has several known failure modes.

#### Failing to pass a `"url"` key in the `POST` request body

In this case, the application will stop processing immediately, and return an error:

```json
{
    "success": false,
    "error": 400,
    "message": "'url'"
}
```

#### Passing a non-url in the `"url"` key in the `POST` request body

In this case, the application will stop processing immediately, and return an error:

```json
{
    "success": false,
    "error": 400,
    "message": "The passed image url was invalid."
}
```

#### Passing a non-image url in the `"url"` key in the `POST` request body

In this case, the application will stop processing after downloading the page, and attempting to interpret it at as an image

```json
{
    "success": false,
    "error": 400,
    "message": ""
}
```
